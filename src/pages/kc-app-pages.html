<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../kc-analytics.html">

<!-- TODO: Add lazy imports -->
<link rel="import" href="kc-page-artifacts.html">
<link rel="import" href="kc-page-browse.html">
<link rel="import" href="kc-page-chapter.html">
<link rel="import" href="kc-page-chapter-preview.html">
<link rel="import" href="kc-page-subjects.html">
<link rel="import" href="kc-page-login.html">
<link rel="import" href="kc-page-not-found.html">

<dom-module id="kc-app-pages">
  <template>
    <kc-analytics
      key="UA-86102655-2"
      current-page="[[route]]"
    ></kc-analytics>

    <app-location
      route="{{route}}"
    ></app-location>
    <app-route
      route="{{route}}"
      pattern="/:page"
      data="{{routeData}}"
      tail="{{subroute}}"
    ></app-route>

    <iron-pages selected="[[selectedPage]]" items="{{__pageElements}}" attr-for-selected="name">
      <kc-page-subjects
        name="subjects"
        label="Subjects"
        route="[[subroute]]"
      ></kc-page-subjects>
      <!-- <kc-page-artifacts
        name="artifacts"
        label="Artifacts"
      ></kc-page-artifacts> -->
      <kc-page-browse
        name="browse"
        label="Browse"
      ></kc-page-browse>
      <kc-page-chapter
        name="chapter"
        label="Chapter"
      ></kc-page-chapter>
      <!-- <kc-page-chapter-preview
        name="chapter-preview"
        label="Chapter Preview"
      ></kc-page-chapter-preview> -->
      <!-- <kc-page-login
        name="login"
        label="Login"
      ></kc-page-login> -->
      <!-- Hidden pages -->
      <kc-page-not-found
        name="not-found"
        hidden
      ></kc-page-not-found>
    </iron-pages>

  </template>
  <script>
    class KcAppPages extends Polymer.Element {
      static get is() {
        return 'kc-app-pages';
      }
      static get properties() {
        return {
          selectedPage: {
            type: String,
            value: 'subjects',
            observer: '__updateRouteData'
          },
          /*
           * Pages available for navigation. NOTE: pages with the hidden
           * property in the template above are not included in this object.
           */
          pages: {
            type: Array,
            value() {
              return [];
            },
            notify: true,
            readOnly: true,
            computed: '__computePages(__pageElements)'
          }
        };
      }
      /**
       * Compute the pages from the page HTMLElements. Elements with the hidden
       * property are excluded.
       * @private
       * @param {HTMLElement[]} pageElements - HTMLElements extracted from iron-pages.
       * @return {Object[]} - Array of page objects or [].
       */
      __computePages(pageElements) {
        if (!Array.isArray(pageElements)) return [];
        return pageElements.filter((pageElement) => !pageElement.hidden).map((pageElement) => {
          return {
            name: pageElement.getAttribute('name') || '',
            label: pageElement.getAttribute('label') || ''
          };
        });
      }
      /**
       * Update route data to reflect selected page.
       * @private
       * @param {String} page - Page with which the route should be updated.
       */
      __updateRouteData(page) {
        this.set('routeData.page', selectedPage);
      }
    }
    window.customElements.define(KcAppPages.is, KcAppPages);
  </script>
</dom-module>
