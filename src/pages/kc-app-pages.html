<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../kc-analytics.html">
<link rel="import" href="../mtz-redux-store-mixin.html">

<!-- TODO: Add lazy imports -->
<link rel="import" href="kc-page-artifacts.html">
<link rel="import" href="kc-page-browse.html">
<link rel="import" href="kc-page-chapter.html">
<link rel="import" href="kc-page-chapter-preview.html">
<link rel="import" href="kc-page-course.html">
<link rel="import" href="kc-page-subjects.html">
<link rel="import" href="kc-page-login.html">
<link rel="import" href="kc-page-not-found.html">

<dom-module id="kc-app-pages">
  <template>
    <kc-analytics
      key="UA-86102655-2"
      current-page="[[route]]"
    ></kc-analytics>

    <iron-pages selected="[[selectedPage]]" items="{{__pageElements}}" attr-for-selected="name">
      <kc-page-subjects
        name="subjects"
        label="Subjects"
      ></kc-page-subjects>
      <kc-page-course
        name="course"
        label="Course"
      ></kc-page-course>
      <kc-page-not-found
        name="not-found"
        hidden
      ></kc-page-not-found>
    </iron-pages>

  </template>
  <script>
    class KcAppPages extends ReduxMixin(Polymer.Element) {
      static get is() {
        return 'kc-app-pages';
      }
      // TODO pages object violates redux. How to extract from page elements?
      static get properties() {
        return {
          selectedPage: {
            type: String,
            statePath: 'selectedPage'
          },
          /*
           * Pages available for navigation. NOTE: pages with the hidden
           * property in the template above are not included in this object.
           */
          pages: {
            type: Array,
            value() {
              return [];
            },
            notify: true,
            readOnly: true,
            computed: '__computePages(__pageElements)'
          }
        };
      }
      connectedCallback() {
        super.connectedCallback();
      }
      /**
       * Compute the pages from the page HTMLElements. Elements with the hidden
       * property are excluded.
       * @private
       * @param {HTMLElement[]} pageElements - HTMLElements extracted from iron-pages.
       * @return {Object[]} - Array of page objects or [].
       */
      __computePages(pageElements) {
        if (!Array.isArray(pageElements)) return [];
        return pageElements.filter((pageElement) => !pageElement.hidden).map((pageElement) => {
          return {
            name: pageElement.getAttribute('name') || '',
            label: pageElement.getAttribute('label') || ''
          };
        });
      }
    }
    window.customElements.define(KcAppPages.is, KcAppPages);
  </script>
</dom-module>
